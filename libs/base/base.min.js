var __reflect=this&&this.__reflect||function(p,c,t){p.__class__=c,t?t.push(c):t=[c],p.__types__=p.__types__?t.concat(p.__types__):t};var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var base;(function(base){function createObj(){return Object.create(null)}base.createObj=createObj})(base||(base={}));var base;(function(base){var initTick=Date.now();function now(){return Date.now()-initTick}base.now=now})(base||(base={}));var base;(function(base){base.ON_CONNECT_CREATE="on_connect_create";base.ON_CONNECT_LOST="on_connect_lost";base.ON_CONNECT_ERROR="on_connect_error";base.IdMsg=base.createObj();function __reg(id,c){c.MsgId=id;base.IdMsg[id]=c}base.__reg=__reg})(base||(base={}));if(!Array.isArray){Array.isArray=function(arg){return Object.prototype.toString.call(arg)==="[object Array]"}}var base;(function(base){var ObjBase=function(_super){__extends(ObjBase,_super);function ObjBase(){return _super!==null&&_super.apply(this,arguments)||this}return ObjBase}(egret.HashObject);base.ObjBase=ObjBase;__reflect(ObjBase.prototype,"base.ObjBase")})(base||(base={}));var base;(function(base){var Notifier=function(_super){__extends(Notifier,_super);function Notifier(){return _super!==null&&_super.apply(this,arguments)||this}Notifier.prototype.sendNt=function(notify,data){base.facade.sendNt(notify,data)};return Notifier}(base.ObjBase);base.Notifier=Notifier;__reflect(Notifier.prototype,"base.Notifier")})(base||(base={}));var base;(function(base){var GameService=function(_super){__extends(GameService,_super);function GameService(){var _this=_super.call(this)||this;_this._recvTick=0;_this.init();return _this}GameService.prototype.init=function(){if(typeof base.traceProto!=="function"){base.traceProto=function(type,proto){}}if(typeof base.onMsg!=="function"){base.onMsg=function(proto){base.facade.sendNt(base.getProtoName(proto),proto)}}};GameService.prototype.connectTo=function(host,port){var self=this;if(self._connection){self._connection.dispose();self._connection=undefined}self._connection=new base.Connection;self._connection.onMsgReceive=base.Handler.alloc(self,self.onMsgReceive);self._connection.onCreated=base.Handler.alloc(self,self.onCreate);self._connection.onLost=base.Handler.alloc(self,self.onLost);self._connection.onError=base.Handler.alloc(self,self.onError);self._connection.connect(host+":"+port)};GameService.prototype.isConnected=function(){if(!this._connection){return false}if(!this._connection.isConnected){return false}return 36e4>base.now()-this._recvTick};GameService.prototype.close=function(){if(this._connection===undefined){return}this._connection.disconnect()};GameService.prototype.onCreate=function(){base.facade.sendNt(base.ON_CONNECT_CREATE)};GameService.prototype.onLost=function(){base.onMsg(base.ON_CONNECT_LOST)};GameService.prototype.onError=function(){base.onMsg(base.ON_CONNECT_ERROR)};GameService.prototype.onMsgReceive=function(proto){this._recvTick=base.now();this.procProto(proto)};GameService.prototype.procProto=function(proto){base.onMsg(proto)};GameService.prototype.onNt=function(protoT,method,context){base.facade.onNt(base.getProtoName(protoT),method,context)};GameService.prototype.offNt=function(protoT,method,context){base.facade.offNt(base.getProtoName(protoT),method,context)};GameService.prototype.sendProto=function(proto){this._connection.send(proto)};return GameService}(base.ObjBase);base.GameService=GameService;__reflect(GameService.prototype,"base.GameService")})(base||(base={}));var base;(function(base){var PoolImpl=function(){function PoolImpl(cls){this._list=[];this._wait=[];this._cls=cls;this.time=this._rTime=base.now();this._aNum=0}PoolImpl.prototype.alloc=function(){var self=this;self._aNum++;self.time=base.now();var item=self._list.length?self._list.pop():new self._cls;if(typeof item.onAlloc==="function"){item.onAlloc()}return item};PoolImpl.prototype.release=function(item){if(!item){return}if(this._wait.indexOf(item)<0){if(typeof item.onRelease==="function"){item.onRelease()}this._wait[this._wait.length]=item}};PoolImpl.prototype.resize=function(time){var self=this;var item;var list=self._list;while(self._wait.length){item=self._wait.pop();if(list.indexOf(item)<0){list[list.length]=item}}if(time-self._rTime>=base.Consts.Pool_Resize_T){var size=self._aNum>base.Consts.Pool_Size?self._aNum:base.Consts.Pool_Size;self._aNum=0;self._rTime=time;while(list.length>size){item=list.pop();if(typeof item.dispose==="function"){item.dispose()}}}};PoolImpl.prototype.dispose=function(){var self=this;var item;for(var _i=0,_a=self._list;_i<_a.length;_i++){item=_a[_i];if(typeof item.dispose==="function"){item.dispose()}}self._list.length=0;for(var _b=0,_c=self._wait;_b<_c.length;_b++){item=_c[_b];if(typeof item.dispose==="function"){item.dispose()}}self._wait.length=0};return PoolImpl}();__reflect(PoolImpl.prototype,"PoolImpl");var Pool=function(){function Pool(){}Pool.getPool=function(cls,createIfNotExist){if(createIfNotExist===void 0){createIfNotExist=false}var prototype=cls.prototype?cls.prototype:Object.getPrototypeOf(cls);var clsName=base.getClassName(cls);var poolId=prototype.__poolId__;if(poolId&&poolId.indexOf(clsName)<0){poolId=null}if(!poolId){if(!createIfNotExist){return null}poolId=base.getClassName(cls)+this.PoolId++;Object.defineProperty(prototype,"__poolId__",{configurable:false,enumerable:false,writable:false,value:poolId})}var pool=this.Pools[poolId];if(!pool){if(!createIfNotExist){return null}pool=new PoolImpl(cls);this.Pools[poolId]=pool}return pool};Pool.alloc=function(cls){if(typeof cls!=="function"){return null}return this.getPool(cls,true).alloc()};Pool.release=function(item){if(!item||typeof item!=="object"){return undefined}var pool=this.getPool(item.constructor,false);if(pool){pool.release(item)}else{if(typeof item.dispose==="function"){item.dispose()}}return undefined};Pool.releaseList=function(list){if(!list||!Array.isArray(list)||!list.length){return}for(var _i=0,list_1=list;_i<list_1.length;_i++){var item=list_1[_i];this.release(item)}list.length=0};Pool.checkUnused=function(){var time=base.now();for(var id in this.Pools){var pool=this.Pools[id];if(!pool){continue}if(time-pool.time>base.Consts.Pool_Unused_T){this.Pools[id]=null;pool.dispose()}else{pool.resize(time)}}};Pool.Pools=base.createObj();Pool.PoolId=1e3;return Pool}();base.Pool=Pool;__reflect(Pool.prototype,"base.Pool")})(base||(base={}));var base;(function(base){var LinkedNode=function(_super){__extends(LinkedNode,_super);function LinkedNode(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this._prev=null;_this._next=null;return _this}Object.defineProperty(LinkedNode.prototype,"prev",{get:function(){return this._prev},enumerable:true,configurable:true});Object.defineProperty(LinkedNode.prototype,"next",{get:function(){return this._next},enumerable:true,configurable:true});LinkedNode.prototype.addToTail=function(prev){var self=this;self._prev=prev;self._next=prev._next;prev._next=self;if(self._next){self._next._prev=self}return self};LinkedNode.prototype.remove=function(){var self=this;if(self._prev){self._prev._next=self._next;if(self._next){self._next._prev=self._prev}}else{if(self._next){self._next._prev=null}}self._prev=self._next=null;return self};LinkedNode.prototype.setData=function(data){this.data=data;return this};LinkedNode.prototype.onAlloc=function(){};LinkedNode.prototype.onRelease=function(){this.remove();this.data=null};LinkedNode.prototype.dispose=function(){this.onRelease()};return LinkedNode}(base.ObjBase);base.LinkedNode=LinkedNode;__reflect(LinkedNode.prototype,"base.LinkedNode",["base.PoolObject","base.DisposeObject"]);var LinkedList=function(_super){__extends(LinkedList,_super);function LinkedList(){var _this=_super.call(this)||this;_this.head=base.Pool.alloc(LinkedNode);_this.tail=base.Pool.alloc(LinkedNode).addToTail(_this.head);return _this}Object.defineProperty(LinkedList.prototype,"begin",{get:function(){return this.head.next},enumerable:true,configurable:true});Object.defineProperty(LinkedList.prototype,"end",{get:function(){return this.tail},enumerable:true,configurable:true});Object.defineProperty(LinkedList.prototype,"empty",{get:function(){return this.head.next===this.tail},enumerable:true,configurable:true});LinkedList.prototype.push=function(data){return base.Pool.alloc(LinkedNode).setData(data).addToTail(this.tail.prev)};LinkedList.prototype.unshift=function(data){return base.Pool.alloc(LinkedNode).setData(data).addToTail(this.head)};LinkedList.prototype.remove=function(data){var node=this.find(data);if(node){base.Pool.release(node);return true}return false};LinkedList.prototype.find=function(data){if(!data){return null}var current=this.begin;var end=this.end;while(current!==end){if(current.data===data){return current}current=current.next}return null};LinkedList.prototype.find2=function(func){if(!func){return null}var current=this.begin;var end=this.end;while(current!==end){if(func(current.data)){return current}current=current.next}return null};LinkedList.prototype.clone=function(){var list=base.Pool.alloc(LinkedList);var begin=this.begin;var end=this.end;while(begin!==end){list.push(begin.data);begin=begin.next}return list};LinkedList.prototype.onAlloc=function(){};LinkedList.prototype.onRelease=function(){var current=this.begin;var end=this.end;var node;while(current!==end){node=current;current=current.next;base.Pool.release(node)}};LinkedList.prototype.dispose=function(){this.onRelease();base.Pool.release(this.head);base.Pool.release(this.tail)};return LinkedList}(base.ObjBase);base.LinkedList=LinkedList;__reflect(LinkedList.prototype,"base.LinkedList",["base.PoolObject","base.DisposeObject"])})(base||(base={}));var base;(function(base){var Mod=function(_super){__extends(Mod,_super);function Mod(name){var _this=_super.call(this)||this;_this._a=false;_this.init(name);return _this}Mod.prototype.init=function(name){var self=this;self.__name=name;self.__mdrCls=base.createObj();self.__mdrIns=base.createObj();self.__models=base.createObj();self.__controllers=base.createObj();self.__remList=base.createObj();base.facade.regMod(self)};Mod.prototype.getName=function(){return this.__name};Mod.prototype.onRegister=function(){this.initCmd();this.initModel();this.initView()};Mod.prototype.initCmd=function(){};Mod.prototype.initModel=function(){};Mod.prototype.initView=function(){};Mod.prototype.regCmd=function(notify,cls){base.facade.onNt(notify,this.executeCommand,this);this.__controllers[notify]=cls};Mod.prototype.unregCmd=function(notify){delete this.__controllers[notify]};Mod.prototype.regProxy=function(type,cls){if(this.__models[type]){console.error("重复注册proxy,ProxyType="+type+","+base.getClassName(cls));return}var proxy=new cls;this.__models[type]=proxy;proxy.initialize()};Mod.prototype.retProxy=function(type){return this.__models[type]};Mod.prototype.regMdr=function(type,mdr){this.__mdrCls[type]=mdr};Mod.prototype.executeCommand=function(n){var cls=this.__controllers[n.type];if(cls!=undefined){var command=new cls;command.$setOwner(this);command.exec(n)}};Mod.prototype.showView=function(type,data,parent){var self=this;if(!self.__mdrCls[type]){return}delete this.__remList[type];var mdr=self.__mdrIns[type];if(!mdr){mdr=self.__mdrIns[type]=new self.__mdrCls[type](parent);mdr.$setOwner(self);mdr.$setType(type)}mdr.show(data)};Mod.prototype.hideView=function(type){var self=this;if(!self.__mdrCls[type]){return}var mdr=self.__mdrIns[type];if(mdr){mdr.hide()}};Mod.prototype.deleteMdr=function(type){var self=this;delete self.__mdrIns[type]};Mod.prototype.remMdr=function(type,disposeImmediately){this.__remList[type]=disposeImmediately?0:base.TimeMgr.time.time;if(!this._a){base.TimeMgr.addUpdateItem(this)}};Mod.prototype.onConnectLost=function(){for(var k in this.__models){var proxy=this.__models[k];if(proxy){proxy.onStartReconnect()}}};Mod.prototype.update=function(time){var self=this;var tmp=Mod.tmpD;tmp.length=0;var t=time.time;var n=0;for(var k in self.__remList){var a=self.__remList[k];if(t-a>base.Consts.Mdr_Dispose_T){tmp.push(k);var mdr=self.__mdrIns[k];self.__mdrIns[k]=undefined;delete self.__mdrIns[k];if(mdr){mdr.dispose()}}n++}if(n===tmp.length){base.TimeMgr.removeUpdateItem(self);self._a=false}for(var i=0,len=tmp.length;i<len;i++){delete self.__remList[tmp[i]]}tmp.length=0};Mod.tmpD=[];return Mod}(base.ObjBase);base.Mod=Mod;__reflect(Mod.prototype,"base.Mod",["base.UpdateItem"])})(base||(base={}));var base;(function(base){base.Consts={Pool_Size:30,Pool_Unused_T:2e4,Pool_Resize_T:3e3,Mdr_Dispose_T:18e4}})(base||(base={}));var base;(function(base){var Proxy=function(_super){__extends(Proxy,_super);function Proxy(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(Proxy.prototype,"service",{get:function(){return Proxy.Service},enumerable:true,configurable:true});Proxy.prototype.initialize=function(){};Proxy.prototype.onStartReconnect=function(){};Proxy.prototype.onProto=function(protoT,method,context){Proxy.Service.onNt(protoT,method,context)};Proxy.prototype.offProto=function(protoT,method,context){Proxy.Service.offNt(protoT,method,context)};Proxy.prototype.sendProto=function(proto){Proxy.Service.sendProto(proto)};Proxy.Service=new base.GameService;return Proxy}(base.Notifier);base.Proxy=Proxy;__reflect(Proxy.prototype,"base.Proxy",["base.IProxy"])})(base||(base={}));var base;(function(base){var Connection=function(_super){__extends(Connection,_super);function Connection(){var _this=_super.call(this)||this;_this.init();return _this}Connection.prototype.init=function(){var self=this;self.socket=new base.Socket;self.socket.onOpen=base.Handler.alloc(self,self.onSocketOpen);self.socket.onClose=base.Handler.alloc(self,self.onSocketClose);self.socket.onError=base.Handler.alloc(self,self.onSocketError);self.socket.onMessage=base.Handler.alloc(self,self.onMessage)};Connection.prototype.connect=function(url){base.traceProto("connect to:",url);this.socket.connect(url)};Object.defineProperty(Connection.prototype,"isConnected",{get:function(){return this.socket.connected},enumerable:true,configurable:true});Connection.prototype.disconnect=function(){if(this.socket){try{this.socket.close()}catch(e){}}};Connection.prototype.send=function(proto){var self=this;if(proto==null){return}if(!self.isConnected){return}var bytes=Connection.encodeMsg(proto);if(bytes){self.socket.send(bytes.buffer)}};Connection.prototype.onMessage=function(buffer){var self=this;var proto=Connection.decodeMsg(buffer);if(proto){if(self.onMsgReceive!=null){self.onMsgReceive.exec([proto])}}};Connection.encodeMsg=function(proto){if(typeof proto!="object"){return null}var cls=proto.constructor;var msgId=cls["MsgId"];if(isNaN(msgId)){return null}if(msgId>0){var protoBytes=proto.constructor["encode"](proto).finish();var typedArray=new Uint8Array(protoBytes.length+2);new DataView(typedArray.buffer).setUint16(0,msgId);typedArray.set(protoBytes,2);base.traceProto("发送协议：",proto);return typedArray}else{base.traceProto("发送无效的协议：",proto);return null}};Connection.decodeMsg=function(buffer){this._time1=Date.now();var id=new DataView(buffer).getUint16(0);var protoBytes=new Uint8Array(buffer,2);var cls=base.IdMsg[id];if(cls&&cls.decode){try{var proto=cls.decode(protoBytes);if(buffer.byteLength>(window["riskProLen"]||3500)){console.error("技术人员看的，忽略 协议: "+cls.$type.name+" 长度: "+buffer.byteLength+" 大于 "+(window["riskProLen"]||3500));console.error("技术人员看的，忽略 二进制解析成 json对象总时间 :"+(Date.now()-this._time1))}base.traceProto("接收协议：",proto);return proto}catch(e){console.error("解析协议出错：id="+id+",name="+base.getClassName(cls));return null}}base.traceProto("接收到未知协议：id",id);return null};Connection.prototype.onSocketOpen=function(){base.traceProto("on socket open");if(this.onCreated){this.onCreated.exec()}};Connection.prototype.onSocketClose=function(){base.traceProto("on socket close");if(this.onLost){this.onLost.exec()}};Connection.prototype.onSocketError=function(){var self=this;base.traceProto("on socket error");if(self.onError){self.onError.exec()}};Connection.prototype.dispose=function(){var self=this;if(!self.socket){return}base.Pool.release(self.onMsgReceive);self.onMsgReceive=undefined;base.Pool.release(self.onCreated);self.onCreated=undefined;base.Pool.release(self.onLost);self.onLost=undefined;base.Pool.release(self.onError);self.onError=undefined;self.disconnect();self.socket.dispose();self.socket=undefined};Connection._time1=0;return Connection}(base.ObjBase);base.Connection=Connection;__reflect(Connection.prototype,"base.Connection")})(base||(base={}));(function(scope){if(!scope){return false}if(scope["TextEncoder"]&&scope["TextDecoder"]){return false}var FastTextEncoder=function(){function FastTextEncoder(utfLabel){if(utfLabel===void 0){utfLabel="utf-8"}this.encoding="utf-8";if(utfLabel!=="utf-8"){throw new RangeError("Failed to construct 'TextEncoder': The encoding label provided ('"+utfLabel+"') is invalid.")}}FastTextEncoder.prototype.encode=function(input){var pos=0;var len=input.length;var at=0;var tlen=Math.max(32,len+(len>>1)+7);var target=new Uint8Array(tlen>>3<<3);while(pos<len){var value=input.charCodeAt(pos++);if(value>=55296&&value<=56319){if(pos<len){var extra=input.charCodeAt(pos);if((extra&64512)===56320){++pos;value=((value&1023)<<10)+(extra&1023)+65536}}if(value>=55296&&value<=56319){continue}}if(at+4>target.length){tlen+=8;tlen*=1+pos/input.length*2;tlen=tlen>>3<<3;var update=new Uint8Array(tlen);update.set(target);target=update}if((value&4294967168)===0){target[at++]=value;continue}else if((value&4294965248)===0){target[at++]=value>>6&31|192}else if((value&4294901760)===0){target[at++]=value>>12&15|224;target[at++]=value>>6&63|128}else if((value&4292870144)===0){target[at++]=value>>18&7|240;target[at++]=value>>12&63|128;target[at++]=value>>6&63|128}else{continue}target[at++]=value&63|128}return target.slice(0,at)};return FastTextEncoder}();var FastTextDecoder=function(){function FastTextDecoder(label,options){if(label===void 0){label="utf-8"}if(options===void 0){options={fatal:false}}this.encoding="utf-8";this.fatal=false;this.ignoreBOM=false;if(label!=="utf-8"){throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+label+"') is invalid.")}if(options.fatal){throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}}FastTextDecoder.prototype.decode=function(buffer,options){if(options===void 0){options={stream:false}}if(options.stream){throw new Error("Failed to decode: the 'stream' option is unsupported.")}var bytes=new Uint8Array(buffer);var pos=0;var len=bytes.length;var out=[];while(pos<len){var byte1=bytes[pos++];if(byte1===0){break}if((byte1&128)===0){out.push(String.fromCharCode(byte1))}else if((byte1&224)===192){var byte2=bytes[pos++]&63;out.push(String.fromCharCode((byte1&31)<<6|byte2))}else if((byte1&240)===224){var byte2=bytes[pos++]&63;var byte3=bytes[pos++]&63;out.push(String.fromCharCode((byte1&31)<<12|byte2<<6|byte3))}else if((byte1&248)===240){var byte2=bytes[pos++]&63;var byte3=bytes[pos++]&63;var byte4=bytes[pos++]&63;var codepoint=(byte1&7)<<18|byte2<<12|byte3<<6|byte4;if(codepoint>65535){codepoint-=65536;out.push(String.fromCharCode(codepoint>>>10&1023|55296));codepoint=56320|codepoint&1023}out.push(String.fromCharCode(codepoint))}else{}}return out.join("")};return FastTextDecoder}();scope["TextEncoder"]=FastTextEncoder;scope["TextDecoder"]=FastTextDecoder;return true})(typeof window!=="undefined"?window:typeof global!=="undefined"?global:null);var base;(function(base_1){var Cmd=function(_super){__extends(Cmd,_super);function Cmd(){return _super!==null&&_super.apply(this,arguments)||this}Cmd.prototype.exec=function(n){};Cmd.prototype.retProxy=function(type){return this.owner.retProxy(type)};Cmd.prototype.$setOwner=function(base){this.owner=base};return Cmd}(base_1.Notifier);base_1.Cmd=Cmd;__reflect(Cmd.prototype,"base.Cmd")})(base||(base={}));var base;(function(base){var Socket=function(){function Socket(){this._connected=false;this._connecting=false}Object.defineProperty(Socket.prototype,"connected",{get:function(){return this._connected},enumerable:true,configurable:true});Socket.prototype.connect=function(url){var self=this;if(self._connected||self._connecting){return}self._url=url;self._connecting=true;try{self._createT=Date.now();var socket=self.socket=new WebSocket(url);socket.binaryType="arraybuffer";self._bindEvent(socket)}catch(e){self.onWSCtorError(e)}};Socket.prototype.close=function(){if(!this._connected){return}this.releaseWS();if(this.onClose){this.onClose.exec()}};Socket.prototype.send=function(buffer){if(!this._connected){return}this.socket.send(buffer)};Socket.prototype._bindEvent=function(socket){var self=this;socket.onopen=function(e){return self.onWSOpen(e)};socket.onclose=function(e){return self.onWSClose(e)};socket.onerror=function(e){return self.onWSError(e)};socket.onmessage=function(e){return self.onWSMessage(e)}};Socket.prototype.onWSCtorError=function(e){var self=this;console.error(e);self.releaseWS();if(self.onError){self.onError.exec()}};Socket.prototype.onWSOpen=function(e){var self=this;console.info("open connection cost:",Date.now()-self._createT);self._connected=true;self._connecting=false;if(self.onOpen){self.onOpen.exec()}};Socket.prototype.onWSClose=function(e){var self=this;if(e.code!==1e3&&e.code!==1006){console.error("WebSocket close:","code:"+e.code,"reason:"+e.reason)}self.releaseWS();if(self.onClose){self.onClose.exec()}};Socket.prototype.onWSError=function(e){var self=this;if(self.socket.readyState!==WebSocket.CLOSED&&self.socket.readyState!==WebSocket.CLOSING){console.error("WebSocket",self._url,"error:",e)}self.releaseWS();if(self.onError){self.onError.exec()}};Socket.prototype.onWSMessage=function(e){var self=this;var message=e.data;var buffer=message;if(typeof message=="string"){buffer=(new TextEncoder).encode(message).buffer}if(self.onMessage){self.onMessage.exec(buffer)}};Socket.prototype.releaseWS=function(){var self=this;self._connected=false;self._connecting=false;var socket=self.socket;self.socket=null;if(socket){socket.onopen=socket.onclose=socket.onerror=socket.onmessage=null;if(socket.readyState!==WebSocket.CLOSED&&socket.readyState!==WebSocket.CLOSING){try{socket.close()}catch(e){}}}};Socket.prototype.dispose=function(){var self=this;self.releaseWS();self.onMessage=base.Pool.release(self.onMessage);self.onOpen=base.Pool.release(self.onOpen);self.onClose=base.Pool.release(self.onClose);self.onError=base.Pool.release(self.onError)};return Socket}();base.Socket=Socket;__reflect(Socket.prototype,"base.Socket")})(base||(base={}));var base;(function(base){var Facade=function(){function Facade(){this._moduleMap=base.createObj();this._observerMap=base.createObj()}Facade.prototype.regMod=function(o){this._moduleMap[o.getName()]=o;o.onRegister()};Facade.prototype.retMod=function(name){var o=this._moduleMap[name];if(!o){console.error("retMod "+name+" undefined exists:"+Object.keys(this._moduleMap).join(","))}return o};Facade.prototype.showView=function(moduleName,viewType,data,parent){var o=this._moduleMap[moduleName];if(o){o.showView(viewType,data,parent)}};Facade.prototype.hideView=function(moduleName,viewType){var o=this._moduleMap[moduleName];if(o){o.hideView(viewType)}};Facade.prototype.deleteMdr=function(moduleName,viewType){var o=this._moduleMap[moduleName];if(o){o.deleteMdr(viewType)}};Facade.prototype.sendNt=function(notify,data){var list=this._observerMap[notify];if(list==null){if(notify.indexOf("msg.s2c_")>-1){console.error("技术人员看的 前端没使用到的协议: "+notify)}return}list=list.clone();var n=base.GameNT.alloc(notify,data);var begin=list.begin;var end=list.end;var handler;while(begin!=end){handler=begin.data;begin=begin.next;handler.exec(n)}base.Pool.release(list);base.Pool.release(n)};Facade.prototype.onNt=function(notify,method,context){var list=this._observerMap[notify];if(list==null){list=this._observerMap[notify]=base.Pool.alloc(base.LinkedList)}else{var node=list.find2(function(handler){return base.Handler.equalMethod(handler,method,context)});if(node){return}}list.push(base.Handler.alloc(context,method))};Facade.prototype.offNt=function(notify,method,context){var list=this._observerMap[notify];if(list==null){return}var node=list.find2(function(handler){return base.Handler.equalMethod(handler,method,context)});if(node){var handler=node.data;base.Pool.release(handler);base.Pool.release(node)}};Facade.prototype.onConnectLost=function(){for(var k in this._moduleMap){this._moduleMap[k].onConnectLost()}};return Facade}();base.Facade=Facade;__reflect(Facade.prototype,"base.Facade");base.facade=new Facade})(base||(base={}));var base;(function(base){var GameNT=function(_super){__extends(GameNT,_super);function GameNT(){return _super!==null&&_super.apply(this,arguments)||this}GameNT.alloc=function(type,body){var n=base.Pool.alloc(GameNT);n._type=type;n._body=body;return n};Object.defineProperty(GameNT.prototype,"type",{get:function(){return this._type},enumerable:true,configurable:true});Object.defineProperty(GameNT.prototype,"body",{get:function(){return this._body},enumerable:true,configurable:true});GameNT.prototype.onAlloc=function(){};GameNT.prototype.onRelease=function(){this._type=null;this._body=null};GameNT.prototype.dispose=function(){this.onRelease()};return GameNT}(base.ObjBase);base.GameNT=GameNT;__reflect(GameNT.prototype,"base.GameNT",["base.PoolObject","base.DisposeObject"])})(base||(base={}));var base;(function(base){function getClassName(value){var type=typeof value;if(!value){return type}if(type!=="object"&&!value.prototype){return type}var prototype=value.prototype?value.prototype:Object.getPrototypeOf(value);var className=prototype.__class__;if(!className){className=prototype.constructor.name;Object.defineProperty(prototype,"__class__",{configurable:false,enumerable:false,writable:false,value:className})}return className}base.getClassName=getClassName})(base||(base={}));var base;(function(base){function getProtoName(proto){if(typeof proto==="string"){return proto}return base.getClassName(proto)}base.getProtoName=getProtoName})(base||(base={}));var base;(function(base){var Time=function(){function Time(){this._serverStartTime=0;this._serverTimeInit=0;this._localTimeInit=0;this._time=base.now()}Object.defineProperty(Time.prototype,"time",{get:function(){return this._time},enumerable:true,configurable:true});Object.defineProperty(Time.prototype,"serverTime",{get:function(){if(this._serverTimeInit==0){return 0}var localPass=base.now()-this._localTimeInit;return this._serverStartTime*1e3+this._serverTimeInit*10+localPass},enumerable:true,configurable:true});Object.defineProperty(Time.prototype,"serverTimeSecond",{get:function(){if(this._serverTimeInit==0){return 0}var localPass=Math.floor((base.now()-this._localTimeInit)/1e3);return this._serverStartTime+Math.floor(this._serverTimeInit/100)+localPass},enumerable:true,configurable:true});Time.prototype.__update=function(){this._time=base.now()};Time.prototype.__setServerTime=function(initTime,startTime){if(startTime===void 0){startTime=0}if(startTime!=0){this._serverStartTime=startTime}this._localTimeInit=base.now();this._serverTimeInit=initTime};return Time}();base.Time=Time;__reflect(Time.prototype,"base.Time")})(base||(base={}));var base;(function(base){var ticker=egret.ticker;var DataKey="__updateData__";var TimeMgr=function(){function TimeMgr(){var _this=this;this._isActivate=true;this._lastUpdate=0;this._time=new base.Time;this._itemList=base.Pool.alloc(base.LinkedList);egret.lifecycle.addLifecycleListener(function(context){context.onUpdate=function(){_this.onUpdate()}});egret.lifecycle.onPause=this.onPause;egret.lifecycle.onResume=this.onResume}TimeMgr.init=function(){if(TimeMgr._instance){return}TimeMgr._instance=new TimeMgr};Object.defineProperty(TimeMgr,"isActivate",{get:function(){return this._instance._isActivate},enumerable:true,configurable:true});Object.defineProperty(TimeMgr,"time",{get:function(){return this._instance._time},enumerable:true,configurable:true});TimeMgr.addUpdateItem=function(item,interval){if(interval===void 0){interval=0}var list=this._instance._itemList;var node=list.find(item);if(node!=null){return}var data=new UpdateData(this._instance._time.time);if(!(+interval|0)){var f=egret.lifecycle.stage.frameRate;interval=Math.floor(1e3/f)}data.interval=interval;item[DataKey]=data;this._instance._itemList.push(item)};TimeMgr.removeUpdateItem=function(item){var list=this._instance._itemList;var idx=list.find(item);if(idx==null){return}item[DataKey]=undefined;this._instance._itemList.remove(item)};TimeMgr.hasUpdateItem=function(item){var list=this._instance._itemList;var idx=list.find(item);return idx!=null};TimeMgr.setServerTime=function(now,startTime){if(startTime===void 0){startTime=0}this._instance._time.__setServerTime(now,startTime)};TimeMgr.getCount=function(item){var list=this._instance._itemList;var node=list.find(item);if(node==undefined){return 0}var data=item[DataKey];return data._updateCnt};TimeMgr.getElapseTime=function(item){var list=this._instance._itemList;var node=list.find(item);if(node==undefined){return 0}var data=item[DataKey];return data._elapseTime};TimeMgr.setWorker=function(worker){var self=TimeMgr._instance;if(worker){self._worker=worker;self._worker.onmessage=self.onTimeout}};TimeMgr.prototype.onTimeout=function(){var self=TimeMgr._instance;if(base.now()-self._lastUpdate<30){return}self.onUpdate()};TimeMgr.prototype.onUpdate=function(){var self=this;var t=base.now();if(t-self._lastUpdate<16){return}self._lastUpdate=t;self._time.__update();var list=self._itemList.clone();var begin=list.begin;var end=list.end;var item;while(begin!=end){item=begin.data;begin=begin.next;var data=item[DataKey];if(!data){continue}data.clac(self._time.time);if(data._updateCnt>0){try{item.update(self._time)}catch(e){console.error("update at "+base.getClassName(item),e)}}}base.Pool.release(list);base.Tween.onTick(self._time);base.Pool.checkUnused()};TimeMgr.prototype.onPause=function(){var self=TimeMgr._instance;self._isActivate=false;if(self._worker){self._worker.postMessage("start")}if(TimeMgr.needPause){ticker.pause()}};TimeMgr.prototype.onResume=function(){var self=TimeMgr._instance;if(self._worker){self._worker.postMessage("stop")}self._isActivate=true;ticker.resume()};TimeMgr.needPause=true;return TimeMgr}();base.TimeMgr=TimeMgr;__reflect(TimeMgr.prototype,"base.TimeMgr");var UpdateData=function(){function UpdateData(time){this._updateCnt=0;this._updateTime=time}UpdateData.prototype.clac=function(time){var self=this;var c=0;self._elapseTime=time-self._updateTime;if(self.interval==0){c=1}else{c=Math.floor(self._elapseTime/self.interval)}if(c>0){self._updateTime=time}self._updateCnt=c};return UpdateData}();__reflect(UpdateData.prototype,"UpdateData")})(base||(base={}));var base;(function(base){var DelayItem=function(_super){__extends(DelayItem,_super);function DelayItem(){return _super!==null&&_super.apply(this,arguments)||this}DelayItem.prototype.dispose=function(){this.onRelease()};DelayItem.prototype.onAlloc=function(){};DelayItem.prototype.onRelease=function(){base.Pool.release(this.handler);this.handler=null};return DelayItem}(base.ObjBase);__reflect(DelayItem.prototype,"DelayItem",["base.PoolObject","base.DisposeObject"]);var Timeout=function(){function Timeout(){}Timeout.add=function(handler,delay){var self=this;var item=base.Pool.alloc(DelayItem);item.idx=++self.index;item.end=base.TimeMgr.time.time+delay;item.handler=handler;self.items[item.idx]=item;self.cnt++;self.check();return item.idx};Timeout.rem=function(idx){var self=this;var item=self.items[idx];if(item){this.cnt--;self.items[idx]=null;delete self.items[idx];base.Pool.release(item);self.check()}};Timeout.check=function(){var self=this;if(self.cnt>0){if(self.added){return}self.added=true;base.TimeMgr.addUpdateItem(self);return}if(!self.added){return}self.added=false;base.TimeMgr.removeUpdateItem(self)};Timeout.update=function(time){var arr=this._tmpDel;var addIdx=0;for(var k in this.items){var item=this.items[k];if(!item||time.time<item.end){continue}item.handler.exec();arr[addIdx++]=item.idx}for(var i=0,n=arr.length;i<n;i++){var idx=arr[i];if(idx){this.rem(idx)}arr[i]=0}};Timeout.index=10;Timeout.items=base.createObj();Timeout.added=false;Timeout.cnt=0;Timeout._tmpDel=new Array(100);return Timeout}();__reflect(Timeout.prototype,"Timeout");function delayCall(handler,delay){return Timeout.add(handler,+delay|0)}base.delayCall=delayCall;function clearDelay(key){if(key===0){return}Timeout.rem(key)}base.clearDelay=clearDelay})(base||(base={}));var base;(function(base){var Tween=function(){function Tween(){this._target=null;this._loop=false;this._steps=[];this._curIdx=0;this._curTime=0;this._isComplete=false;this._errCnt=0}Tween.get=function(target,vars){if(vars===void 0){vars=null}if(!target){console.error(new Error("Tween.get target:"+target));return null}return(new Tween)._init(target,vars)};Tween.remove=function(target){var checkFn=function(t){return t&&t._target===target};var node=this._tweens.find2(checkFn);while(node){var tween=node.data;tween.dispose();this._tweens.remove(tween);node=this._tweens.find2(checkFn)}};Tween.onTick=function(time){var elapseTime=time.time-this._lastTick;this._lastTick=time.time;var list=this._tweens.clone();var begin=list.begin;var end=list.end;var arr=this._tmpDel;var addIdx=0;while(begin!=end){var tween=begin.data;begin=begin.next;tween.advanceTime(elapseTime);if(tween._isComplete){arr[addIdx++]=tween}}for(var i=0,n=arr.length;i<n;i++){var tween=arr[i];if(tween){tween.dispose();this._tweens.remove(tween)}arr[i]=null}base.Pool.release(list)};Tween._reg=function(tween){this._tweens.push(tween)};Tween._checkDuration=function(duration){duration=+duration|0;if(duration<0){duration=0}return duration};Tween._parseVars=function(vars){var obj=base.createObj();for(var k in vars){var v=vars[k];if(typeof v==="number"){obj[k]=v}}return obj};Tween.copyFrom=function(keys,target){var obj=base.createObj();for(var k in keys){obj[k]=target[k]}return obj};Tween.prototype._init=function(target,vars){if(vars===void 0){vars=null}var self=this;self._target=target;self._loop=vars&&vars.loop;self._curIdx=0;self._curTime=0;self._isComplete=false;Tween._reg(self);return self};Tween.prototype.to=function(vars,duration,onUpdate,ease){if(onUpdate===void 0){onUpdate=null}if(ease===void 0){ease=base.Linear.easeNone}if(!vars){return this}ease=ease||base.Linear.easeNone;duration=Tween._checkDuration(duration);var t=this.getTotalTime();var toValues=Tween._parseVars(vars);this._steps.push({st:t,et:t+duration,to:toValues,e:ease,h:onUpdate});return this};Tween.prototype.from=function(vars,duration,onUpdate,ease){if(onUpdate===void 0){onUpdate=null}if(ease===void 0){ease=base.Linear.easeNone}if(!vars){return this}ease=ease||base.Linear.easeNone;duration=Tween._checkDuration(duration);var t=this.getTotalTime();var fromValues=Tween._parseVars(vars);this._steps.push({st:t,et:t+duration,from:fromValues,e:ease,h:onUpdate});return this};Tween.prototype.delay=function(duration){duration=Tween._checkDuration(duration);var t=this.getTotalTime();this._steps.push({st:t,et:t+duration});return this};Tween.prototype.exec=function(handler){var t=this.getTotalTime();this._steps.push({st:t,et:t,h:handler});return this};Tween.prototype.getTotalTime=function(){var list=this._steps;if(list.length){return list[list.length-1].et}return 0};Tween.prototype.applyCur=function(start){if(start===void 0){start=false}var self=this;var curStep=self._steps[self._curIdx];if(!curStep){return}if(start){if(!curStep.to&&!curStep.from){if(curStep.h){curStep.h.exec()}return}if(!curStep.from){curStep.from=Tween.copyFrom(curStep.to,self._target)}if(!curStep.to){curStep.to=Tween.copyFrom(curStep.from,self._target)}}if(curStep.from){var ct=self._curTime>curStep.et?curStep.et:self._curTime;var dur=curStep.et-curStep.st;var t=ct-curStep.st;for(var k in curStep.to){var a=curStep.from[k];var b=curStep.to[k];var v=curStep.e(t,a,b-a,dur);self._target[k]=v}if(curStep.h){curStep.h.exec()}}};Tween.prototype.advanceTime=function(elapseTime){var self=this;if(elapseTime<=0||self._isComplete){return}var finalFrame=self._steps.length-1;if(finalFrame<0){return}var totalTime=self.getTotalTime();if(self._loop&&self._curTime>=totalTime){self._curTime=0;self._curIdx=0}if(self._target&&self._target.hasOwnProperty("$stage")&&!self._target.$stage){self._errCnt++;if(self._errCnt>120){self.printError();self._errCnt=-6e4}}self.applyCur(self._curTime===0);if(self._curTime<totalTime){self._curTime+=elapseTime;self.applyCur();var step=self._steps[self._curIdx];while(step&&self._curTime>=step.et){if(self._curIdx===finalFrame){if(self._loop){self._curTime-=totalTime;self._curIdx=0}else{self._isComplete=true;self._curTime=totalTime;break}}else{self._curIdx++;self.applyCur(true)}step=self._steps[self._curIdx]}if(self._curIdx===finalFrame&&self._curTime===totalTime){self._isComplete=true}}};Tween.prototype.printError=function(){var obj=this._target;while(obj.parent&&!obj.__mdr__){obj=obj.parent}console.error("Tween target stage is null!!!","view:"+base.getClassName(obj),"target:"+base.getClassName(this._target))};Tween.prototype.dispose=function(){this._errCnt=0;for(var _i=0,_a=this._steps;_i<_a.length;_i++){var step=_a[_i];base.Pool.release(step.h);step.h=null}this._steps.length=0;this._target=null};Tween._tweens=base.Pool.alloc(base.LinkedList);Tween._lastTick=0;Tween._tmpDel=new Array(100);return Tween}();base.Tween=Tween;__reflect(Tween.prototype,"base.Tween")})(base||(base={}));var base;(function(base){var Back=function(){function Back(){}Back.easeIn=function(t,b,c,d,s){if(s===void 0){s=1.70158}return c*(t/=d)*t*((s+1)*t-s)+b};Back.easeOut=function(t,b,c,d,s){if(s===void 0){s=1.70158}return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b};Back.easeInOut=function(t,b,c,d,s){if(s===void 0){s=1.70158}if((t/=d*.5)<1)return c*.5*(t*t*(((s*=1.525)+1)*t-s))+b;return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b};Back.easeOutExtra=function(t,b,c,d,s){if(s===void 0){s=8}return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b};return Back}();base.Back=Back;__reflect(Back.prototype,"base.Back");var Bounce=function(){function Bounce(){}Bounce.easeOut=function(t,b,c,d){if((t/=d)<1/2.75){return c*(7.5625*t*t)+b}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+.75)+b}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+.9375)+b}else{return c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}};Bounce.easeIn=function(t,b,c,d){return c-Bounce.easeOut(d-t,0,c,d)+b};Bounce.easeInOut=function(t,b,c,d){if(t<d*.5)return Bounce.easeIn(t*2,0,c,d)*.5+b;else return Bounce.easeOut(t*2-d,0,c,d)*.5+c*.5+b};return Bounce}();base.Bounce=Bounce;__reflect(Bounce.prototype,"base.Bounce");var Circ=function(){function Circ(){}Circ.easeIn=function(t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b};Circ.easeOut=function(t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b};Circ.easeInOut=function(t,b,c,d){if((t/=d*.5)<1)return-c*.5*(Math.sqrt(1-t*t)-1)+b;return c*.5*(Math.sqrt(1-(t-=2)*t)+1)+b};return Circ}();base.Circ=Circ;__reflect(Circ.prototype,"base.Circ");var Cubic=function(){function Cubic(){}Cubic.easeIn=function(t,b,c,d){return c*(t/=d)*t*t+b};Cubic.easeOut=function(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b};Cubic.easeInOut=function(t,b,c,d){if((t/=d*.5)<1)return c*.5*t*t*t+b;return c*.5*((t-=2)*t*t+2)+b};Cubic.power=2;return Cubic}();base.Cubic=Cubic;__reflect(Cubic.prototype,"base.Cubic");var Elastic=function(){function Elastic(){}Elastic.easeIn=function(t,b,c,d,a,p){if(a===void 0){a=0}if(p===void 0){p=0}var s;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(!a||c>0&&a<c||c<0&&a<-c){a=c;s=p/4}else s=p/Elastic._2PI*Math.asin(c/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*Elastic._2PI/p))+b};Elastic.easeOut=function(t,b,c,d,a,p){if(a===void 0){a=0}if(p===void 0){p=0}var s;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(!a||c>0&&a<c||c<0&&a<-c){a=c;s=p/4}else s=p/Elastic._2PI*Math.asin(c/a);return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*Elastic._2PI/p)+c+b};Elastic.easeInOut=function(t,b,c,d,a,p){if(a===void 0){a=0}if(p===void 0){p=0}var s;if(t==0)return b;if((t/=d*.5)==2)return b+c;if(!p)p=d*(.3*1.5);if(!a||c>0&&a<c||c<0&&a<-c){a=c;s=p/4}else s=p/Elastic._2PI*Math.asin(c/a);if(t<1)return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*Elastic._2PI/p))+b;return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*Elastic._2PI/p)*.5+c+b};Elastic._2PI=Math.PI*2;return Elastic}();base.Elastic=Elastic;__reflect(Elastic.prototype,"base.Elastic");var Expo=function(){function Expo(){}Expo.easeIn=function(t,b,c,d){return t==0?b:c*Math.pow(2,10*(t/d-1))+b-c*.001};Expo.easeOut=function(t,b,c,d){return t==d?b+c:c*(-Math.pow(2,-10*t/d)+1)+b};Expo.easeInOut=function(t,b,c,d){if(t==0)return b;if(t==d)return b+c;if((t/=d*.5)<1)return c*.5*Math.pow(2,10*(t-1))+b;return c*.5*(-Math.pow(2,-10*--t)+2)+b};return Expo}();base.Expo=Expo;__reflect(Expo.prototype,"base.Expo");var IntegerSine=function(){function IntegerSine(){}IntegerSine.easeIn=function(t,b,c,d){return-c*Math.cos(t/d*IntegerSine._HALF_PI)+c+b};IntegerSine.easeOut=function(t,b,c,d){return c*Math.sin(t/d*IntegerSine._HALF_PI)+b};IntegerSine.easeInOut=function(t,b,c,d){return-c*.5*(Math.cos(Math.PI*t/d)-1)+b};IntegerSine._HALF_PI=Math.PI*.5;return IntegerSine}();base.IntegerSine=IntegerSine;__reflect(IntegerSine.prototype,"base.IntegerSine");var Linear=function(){function Linear(){}Linear.easeNone=function(t,b,c,d){return c*t/d+b};Linear.easeIn=function(t,b,c,d){return c*t/d+b};Linear.easeOut=function(t,b,c,d){return c*t/d+b};Linear.easeInOut=function(t,b,c,d){return c*t/d+b};Linear.power=0;return Linear}();base.Linear=Linear;__reflect(Linear.prototype,"base.Linear");var Quad=function(){function Quad(){}Quad.easeIn=function(t,b,c,d){return c*(t/=d)*t+b};Quad.easeOut=function(t,b,c,d){return-c*(t/=d)*(t-2)+b};Quad.easeInOut=function(t,b,c,d){if((t/=d*.5)<1)return c*.5*t*t+b;return-c*.5*(--t*(t-2)-1)+b};Quad.power=1;return Quad}();base.Quad=Quad;__reflect(Quad.prototype,"base.Quad");var Quart=function(){function Quart(){}Quart.easeIn=function(t,b,c,d){return c*(t/=d)*t*t*t+b};Quart.easeOut=function(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b};Quart.easeInOut=function(t,b,c,d){if((t/=d*.5)<1)return c*.5*t*t*t*t+b;return-c*.5*((t-=2)*t*t*t-2)+b};Quart.power=3;return Quart}();base.Quart=Quart;__reflect(Quart.prototype,"base.Quart");var Quint=function(){function Quint(){}Quint.easeIn=function(t,b,c,d){return c*(t/=d)*t*t*t*t+b};Quint.easeOut=function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b};Quint.easeInOut=function(t,b,c,d){if((t/=d*.5)<1)return c*.5*t*t*t*t*t+b;return c*.5*((t-=2)*t*t*t*t+2)+b};Quint.power=4;return Quint}();base.Quint=Quint;__reflect(Quint.prototype,"base.Quint");var Sine=function(){function Sine(){}Sine.easeIn=function(t,b,c,d){return-c*Math.cos(t/d*Sine._HALF_PI)+c+b};Sine.easeOut=function(t,b,c,d){return c*Math.sin(t/d*Sine._HALF_PI)+b};Sine.easeInOut=function(t,b,c,d){return-c*.5*(Math.cos(Math.PI*t/d)-1)+b};Sine._HALF_PI=Math.PI*.5;return Sine}();base.Sine=Sine;__reflect(Sine.prototype,"base.Sine");var Strong=function(){function Strong(){}Strong.easeIn=function(t,b,c,d){return c*(t/=d)*t*t*t*t+b};Strong.easeOut=function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b};Strong.easeInOut=function(t,b,c,d){if((t/=d*.5)<1)return c*.5*t*t*t*t*t+b;return c*.5*((t-=2)*t*t*t*t+2)+b};Strong.power=4;return Strong}();base.Strong=Strong;__reflect(Strong.prototype,"base.Strong")})(base||(base={}));var base;(function(base){var Handler=function(_super){__extends(Handler,_super);function Handler(){return _super!==null&&_super.apply(this,arguments)||this}Handler.alloc=function(context,method,args,once){if(args===void 0){args=null}if(once===void 0){once=false}return base.Pool.alloc(Handler).set(Handler._guid++,context,method,args?args:[],!!once)};Handler.equalMethod=function(handler,method,context){if(!handler||!method){return false}return handler._method===method&&handler._context===context};Handler.equal=function(handler,other){if(!handler||!other){return false}return handler._method===other._method&&handler._context===other._context};Object.defineProperty(Handler.prototype,"context",{get:function(){return this._context},enumerable:true,configurable:true});Object.defineProperty(Handler.prototype,"method",{get:function(){return this._method},enumerable:true,configurable:true});Handler.prototype.set=function(id,context,method,args,once){var self=this;self._id=id;self._context=context;self._method=method;self._args=args;self._once=once;return self};Handler.prototype.exec=function(data){var self=this;if(!self._method){return null}var id=self._id;var args;if(data==null){args=self._args}else if(!self._args&&!data.unshift){args=data}else if(self._args){args=self._args.concat(data)}else{args=data}var result=self.doExec(self._context,self._method,args);if(self._id===id&&self._once){base.Pool.release(self)}return result};Handler.prototype.doExec=function(context,method,args){var result=null;try{result=method.apply(context,args)}catch(e){var arr=[];if(context){for(var k in context){if(context[k]===method){arr[arr.length]=k+" at "+base.getClassName(context);break}}if(!arr.length){arr[arr.length]=base.getClassName(context)}}if(!!e){arr[arr.length]=e}console.error.apply(console,arr)}return result};Handler.prototype.dispose=function(){this.onRelease()};Handler.prototype.onAlloc=function(){};Handler.prototype.onRelease=function(){var self=this;self._context=null;self._method=null;self._args=undefined;self._once=false};Handler._guid=1;return Handler}(base.ObjBase);base.Handler=Handler;__reflect(Handler.prototype,"base.Handler",["base.PoolObject","base.DisposeObject"])})(base||(base={}));var base;(function(base_2){var Mdr=function(_super){__extends(Mdr,_super);function Mdr(parent){var _this=_super.call(this)||this;_this.isEasyHide=false;_this.__show=false;_this.__parent=parent;_this.__mdrName=base_2.getClassName(_this);_this.__ntHandler=base_2.createObj();_this.__egretHandler=[];return _this}Object.defineProperty(Mdr.prototype,"name",{get:function(){return this.__mdrName},enumerable:true,configurable:true});Mdr.prototype.$setOwner=function(base){this._owner=base};Mdr.prototype.$setType=function(type){this.__viewType=type};Mdr.prototype.mark=function(key,type){this.__viewKey={key:key,type:type};return undefined};Mdr.prototype.newView=function(){var self=this;if(!self.__viewKey){return}if(self.__viewKey){self[self.__viewKey.key]=new self.__viewKey.type;self[self.__viewKey.key].mdrName=this.name}};Mdr.prototype.getView=function(){var self=this;if(self.__viewKey){return self[self.__viewKey.key]}return undefined};Mdr.prototype.onNt=function(notify,method,context){var self=this;var handler=self.__ntHandler[notify];if(base_2.Handler.equalMethod(handler,method,context)){return}self.__ntHandler[notify]=base_2.Handler.alloc(context,method);base_2.facade.onNt(notify,self.notifyObservers,self)};Mdr.prototype.offNt=function(notify){var self=this;var handler=self.__ntHandler[notify];delete self.__ntHandler[notify];base_2.Pool.release(handler);base_2.facade.offNt(notify,self.notifyObservers,self)};Mdr.prototype.onEgret=function(target,type,listener,thisObject){if(!target||!type||!listener){return}thisObject=thisObject||this;var event={target:target,type:type,listener:listener,thisObject:thisObject};this.__egretHandler.push(event);target.addEventListener(type,listener,thisObject)};Mdr.prototype.offEgret=function(target,type,listener,thisObject){if(!target||!type||!listener){return}thisObject=thisObject||this;target.removeEventListener(type,listener,thisObject);var list=this.__egretHandler;for(var i=0,len=list.length;i<len;i++){var event_1=list[i];if(event_1&&event_1.target===target&&event_1.type===type&&event_1.listener===listener){list.splice(i,1);i--;len--}}};Mdr.prototype.notifyObservers=function(ntfy){var handler=this.__ntHandler[ntfy.type];if(handler){handler.exec(ntfy)}};Mdr.prototype.show=function(obj){var self=this;self.__show=true;self._showArgs=obj;self.doShow()};Mdr.prototype.doShow=function(){var self=this;if(!self.__show){return}if(!self.__viewInit){self.__viewInit=true;self.newView();Object.defineProperty(self.getView(),"__mdr__",{value:self,enumerable:false,writable:true});self.onAssetLoaded();self.onInit()}self.__parent.addChild(self.getView());self.addListeners();try{self.onShow()}catch(e){self.onErr("onShow",e)}};Mdr.prototype.hide=function(disposeImmediately){if(disposeImmediately===void 0){disposeImmediately=false}this.doHide(disposeImmediately)};Mdr.prototype.doHide=function(disposeImmediately){var self=this;if(!self.__show){return}self.__show=false;for(var key in self.__ntHandler){self.offNt(key)}var list=this.__egretHandler;while(list.length){var event_2=list.pop();if(event_2){event_2.target.removeEventListener(event_2.type,event_2.listener,event_2.thisObject)}}var view=self.getView();if(view&&view.parent){view.parent.removeChild(view)}try{this.onHide()}catch(e){this.onErr("onHide",e)}finally{this._showArgs=null;this._owner.remMdr(this.__viewType,disposeImmediately)}};Mdr.prototype.dispose=function(){};Mdr.prototype.onErr=function(method,e){console.error(method+" at "+this.__mdrName,e)};Mdr.prototype.onAssetLoaded=function(){};Mdr.prototype.onInit=function(){};Mdr.prototype.addListeners=function(){};Mdr.prototype.onShow=function(){};Mdr.prototype.onHide=function(){};Mdr.prototype.showView=function(type,data){this._owner.showView(type,data)};Mdr.prototype.retProxy=function(type){return this._owner.retProxy(type)};return Mdr}(base_2.Notifier);base_2.Mdr=Mdr;__reflect(Mdr.prototype,"base.Mdr",["base.DisposeObject"])})(base||(base={}));